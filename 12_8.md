# Домашнее задание к занятию "12.8 Резервное копирование баз данных" - `Кравцов Петр`

### Задание 1
1.1 В данном случае можно использовать дифференциальный бекап. в начале операционного дня делать полный бекап, а затем с 
заданной периодичностью(исходя из второго подпункта можно выставить 1час) делать снимки которые будут включать все изменения начиная 
с полного бекапа. 
Или можно поменять стратегию и делать после завершения операционного дня полный бекап и все, тогда в течении следующего дня всегда будет снимок данных
за предыдущий день

1.2 В данном случае можно также использовать дифферинциальный бекап с периодичностью в 1 час, тогда мы сможем восстановить данные на состояние на любой час
в течении операционного дня. Как вариант можно использовать инкрементальный бекап, чтобы избежать избыточности данных при дифференциальном подходе.
Тут уже нужно оценивать отдельно удобно ли будет проливать 8-12 инкрементальных бекапов или это допустимая загруженность


### Задание 2
pg_dump -Fc netodb > netodb.dump (-Fc - задаем формат резервной копии. ключ с(custom) формирует резервную копию в архивном формате)
pg_restore -C -d postgres netodb.dump (-C означает что нужно создать бд перед восстановлением, -d адаем имя целевой бд)

Можно написать баш скрипт с этими инстуркциями и с помощью crontab настроить шедуллер для запуска этого скрипта

### Задание 3
Сначала необходимо включить бинарное логгирование. Изменить файл /etc/mysql/mysql.conf.d/mysqld.cnf
Log_bin = /var/log/mysql/mysql-bin.log
expire_logs_days = 10

Перезагрузить сервис mySQl 
systemctl restart mysql

Проверить командой ls -l /var/log/mysql/ что у нас есть файл mysql-bin.000001 в который заипсываются все изменения в БД

Делаем полный бекап 
mysqldump -uroot -p --all-databases --single-transaction --flush-logs --master-data=2 > full_backup.sql

флаг --flush-logs закроет текущий файл mysql-bin.000001 и создаст новй mysql-bin.000002 куда дальше будут записываться изменения в бд

В дальнейшем делать инкрементальный бекапы нужно командой mysqladmin -uroot -p flush-logs который будет закрывать текущий файл mysql-bin и создавать 
со след индексом в названии файла.

